{%extends "base.html" %}
{%block title%}
MENU
{%endblock title%}
{%block css%}
{%load static%}
<style type="text/css">
	body{
		padding: 0;
		margin : 0px;
		font-family: Helvetica;
	}
	.content{
		grid-area: con;
		width: 400px;
		height: 400px;
		display: block;
	}
	.image{
		grid-area: im;
		width: 100%;
		height: 400px;
		border-radius :200px;

	}
	.outerContainer{
		display: grid;
		grid-gap: 5px;
		grid-template-areas: 'con con con im im';
		height: 400px;
		margin: 20px;
		padding: 30px 30px;
		background-color: rgba(255,255,255,0.6);
		border-radius :15px;
	}
	item{
		font-size: 35px;
		margin: 20px 0px ;
		display: block;
		font-weight: bold;
	}
	desc{
		font-size: 25px;
		max-height: 50px;
		overflow: auto;
	}
	.value{
		text-decoration: none;
		background: #66baa8;
		color : white;
		width:20%;
		height: 60px;
		font-size: 35px;
		border:none;
		text-align: center;
		border-radius: 10px;
		vertical-align: bottom;
		font-weight: bold;
	}
	.minus{
		text-decoration: none;
		background: #66baa8;
		color : white;
		width:20%;
		height: 60px;
		font-size: 50px;
		border:none;
		text-align: center;
		border-radius: 30px 0 0 30px;
		vertical-align: bottom;
	}
	.plus{
		text-decoration: none;
		background: #66baa8;
		color : white;
		width:20%;
		height: 60px;
		font-size: 50px;
		border:none;
		text-align: center;
		border-radius: 0 30px 30px 0;
		vertical-align: bottom;
	}
		/*---------------------------------------------sidenav---------------------------------------------*/
	.sidenav {
	    height: 100%;
	    width: 0;
	    position: fixed;
	    z-index: 2;
	    top: 0;
	    right: 0;
	    background-color: rgba(100,100,100,0.85);
	    overflow-x: hidden;
	    transition: 0.5s;
	}
	.closeNav{
		padding: 50px;
		border: none;
		background-color: rgb(0,255,0);
		color: white;
		font-size: 40px;
		width: 50%;
		display: inline;
	}
	.placeBtns{
		margin-top: 23px;
		margin-bottom: 5px;
		padding: 38px 0px;
		width:48%;
		height: 49%;
		border: none;
		background-color: #44aa44;
		color: white;
		font-size: 25px;
		display: inline-block;

	}
	.selectedItems{
		color: white;
		margin:20px;
		background-size: cover;
		border-radius: 50px;
	}
	.selectedItemsDetails{
		padding: 50px;
		background:rgba(0,0,0,0.6);
		border-radius: 50px;
	}
	/*---------------------------------------navbar---------------------------------------*/
	.navbar {
	    overflow: hidden;
	    background-color: rgba(255,255,255,0.6);
	    border-radius: 15px;
	    margin: 20px;
	    position: fixed;
  		top: 0;
  		width: 100%;
  		background-color:rgba(255,255,255,0.9); 
  		border-radius: 0px 0px 20px 20px ;
	    margin: 0px;
	    z-index: 2;
	}
	.navbar a {
	    float: left;
	    font-size: 32px;
	    color: black;
	    text-align: center;
	   	padding: 20px 20px;
	    text-decoration: none;

	}
	.subnav {
	    float: left;
	    overflow: hidden;
	    padding: 0px 40px;
	}
	.subnav p{
		text-align: center;
	}

	.subnavbtn {
	    font-size: 32px;    
	    border: none;
	    outline: none;
	    color: black;
	    padding: 40px 40px 37px 40px;
	    background-color: inherit;
	    font-family: inherit;
	    margin: 0;
	    font-weight: bold;
	}

	.placeorder:hover{
	    background-color: #66cc66;
	}
	.placeorder{
		float: right;
	}
	/*-------------------------------------*/
	.sticky{
		position: fixed;
  		top: 0;
  		width: 100%;
  		background-color:rgba(255,255,255,0.9); 
  		border-radius: 0px 0px 20px 20px ;
	    margin: 0px;
	}
</style>

<!-- template css begins -->
<style>
	.switch {
	  position: relative;
	  display: inline-block;
	  width: 75px;
	  height: 34px;
	}

	.switch input { 
	  opacity: 0;
	  width: 0;
	  height: 0;
	}

	.slider {
	  position: absolute;
	  cursor: pointer;
	  top: 0;
	  left: 0;
	  right: 0;
	  bottom: 0;
	  background-color: rgba(150,150,150,0.2);
	  -webkit-transition: .4s;
	  transition: .4s;
	  border-radius: 34px;
	}

	.slider:before {
	  position: absolute;
	  content: "";
	  height: 26px;
	  width: 26px;
	  left: 4px;
	  bottom: 4px;
	  background-color: white;
	  -webkit-transition: .4s;
	  transition: .4s;
	 border-radius: 50%;

	}

	input:checked + .slider {
	  background-color: #66cc66;
	}

	input:focus + .slider {
	  box-shadow: 0 0 1px #66cc66;
	}

	input:checked + .slider:before {
	  transform: translateX(40px);
	}
/*tax slider css*/
	.switchTax {
	  position: relative;
	  display: inline-block;
	  width: 75px;
	  height: 34px;
	}

	.switchTax input { 
	  opacity: 0;
	  width: 0;
	  height: 0;
	}

	.sliderTax {
	  position: absolute;
	  cursor: pointer;
	  top: 0;
	  left: 0;
	  right: 0;
	  bottom: 0;
	  background-color: rgba(150,150,150,0.2);
	  -webkit-transition: .4s;
	  transition: .4s;
	  border-radius: 34px;
	}

	.sliderTax:before {
	  position: absolute;
	  content: "";
	  height: 26px;
	  width: 26px;
	  left: 4px;
	  bottom: 4px;
	  background-color: white;
	  -webkit-transition: .4s;
	  transition: .4s;
	 border-radius: 50%;

	}

	input:checked + .sliderTax {
	  background-color: #66cc66;
	}

	input:focus + .sliderTax {
	  box-shadow: 0 0 1px #66cc66;
	}

	input:checked + .slideTax:before {
	  transform: translateX(40px);
	}

	/*css for search bar*/
	#mySearch {
	  width:35%;
	  font-size: 16px;
	  padding: 20px;
	  border: 1px solid #ddd;
	  margin: 25px;
	  background: rgba(255,255,255,0.75);
	  border-radius: 15px;
	}
	.thebody{
		margin-top : 140px;
	}
	.amount{
		font-size: 28px;
		color: #228B22;
		display: inline-block;
	}
	.amountInputField{
		text-decoration: none;
		background: rgba(0,0,0,0);
		display: inline-block;
		color : #228B22 ;
		width:150px;
		font-size: 35px;
		border:none;
		text-align: center;
	}
	.amountInputFieldWithGst{
		text-decoration: none;
		background: rgba(0,0,0,0);
		display: inline-block;
		color : #228B22 ;
		width:150px;
		font-size: 35px;
		border:none;
		text-align: center;
	}
	.UnitPriceInputField{
		text-decoration: none;
		background: rgba(0,0,0,0);
		display: inline-block;
		color : black;
		width:150px;
		font-size: 25px;
		border:none;
		text-align: center;
	}
	.gstPercentage input{
		text-decoration: none;
		background: rgba(0,0,0,0);
		display: inline;
		color : #228B22 ;
		width:30px;
		font-size: 15px;
		border:none;
		text-align: center;
	}
</style>
{%endblock css%}
{%block body%}
<div class="navbar" id="navbar">
	
  	<div class="subnav">
  		<p><small style="font-size: 25px;">VEG only</small></p>
    	<label class="switch">
  		<input type="checkbox" id="but">
  		<span class="slider round"></span>
		</label>
	</div>
	<input type="text" id="mySearch" onkeyup="filterItems()" placeholder="Search Items.." title="Type in a name">

	<div class="placeorder">
			<input class ="subnavbtn" type="button" value="PLACE ORDER" onclick="toggle()">
	</div>
</div>
<div id="mySidenav" class="sidenav">
  	<div id="sideBarHeader">
  		<form  method="POST" action="{% url 'placeOrder' %}">
	  		{%csrf_token%}
  			<input class="placeBtns" style="margin-left: 10px;background: #323232;border-radius:20px 0 0 20px;" type="button" value="ADD OTHER" onclick="toggle()" class="closeNav">
	  		<input type="hidden" name="tokenNum" value="{{tokenNum}}">
	  		<input class="placeBtns" style="border-radius: 0 20px 20px 0;margin-right: 7px;" type="submit" value="PLACE ORDER" id="placeOrderBtn">
	  	</form>
  	</div>
</div>
<!-- sidebar ends navbar begins -->

<!-- navbar ends -->
<div class="thebody" >
	{%for item in MenuItems %}
	<div class="outerContainer" onclick="closeNav()" id="{{item.itemNum}}"> 
		<!-- if user clicks anywhere other than popup close popup -->
		<div class="content" style="position:relative;">
			<item>
			<itemNum id="{{item.itemNum}}">{{item.itemNum}}</itemNum>.<itemName id="{{item.itemNum}}Name">{{item.itemName}}</itemName>
			</item>
			<h1>₹<input class="UnitPriceInputField" id="{{item.itemNum}}UnitPrice" value="{{item.itemUnitPrice}}"></h1>

			<desc id="{{item.itemNum}}Desc">{{item.itemDesc}}</desc>
			<br>
			<!-- <input id="{{item.itemNum}}gstAmount" value="0" style="display:'';" disabled="true"> -->
			
			<div style="display: 'none';" class="AmountExtDiv" id="{{item.itemNum}}AmountExtDiv">
				<h1 class="amount" >Amount: ₹
					<input class="amountInputField" id="{{item.itemNum}}Amount" value="0" disabled="true" style="display: '';">
					<input class="amountInputFieldWithGst" id="{{item.itemNum}}gstAmount" value="0" disabled="true" style="display: none;">
					<small class="gstPercentage" style="font-size: 20px;">+<input id="{{item.itemNum}}gst" value="{{item.gst}}" style="display:'';" disabled="true">% gst</small>
					<div style="display: inline-block;right:0"><small style="font-size: 14px;">*Show amount Including Taxes</small>
			    	<label class="switch">
			  		<input type="checkbox" class="taxes">
			  		<span class="slider round"></span>
					</label>
					</div>
				</h1>
			</div>

			<div id="{{item.itemNum}}inputs" style=" position: absolute;bottom: 0;">
				<input class="minus" type="button" name="Add" onclick="minus('{{item.itemNum}}')" value="-">
				<input class="value" type="number" name="quantity" value=0 id="{{item.itemNum}}Quantity" disabled>
				<input class="plus" type="button" name="Add" onclick="plus('{{item.itemNum}}')" value="+">
			</div>
		</div>
		{%load static%}
		{% with 'Images/'|add:item.itemImageName as itemImage_static %}
		<img src="{% static itemImage_static %}" class="image" alt="{{item.itemImageName}}" align="left">
		{%endwith%}
	</div>


	{%endfor%}
	</div>
	<script type="text/javascript">
	{%for added in addedMenuItems%}
		document.getElementById("{{added.itemNum}}Quantity").value = '{{added.quantity}}';
	{%endfor%}
	</script>
	{%load static%}
	<script type="text/javascript" src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
	<script type="text/javascript">
		window.onload = function()
		{
			$(".outerContainer").each(function(){
				var Uprice = document.getElementById(this.id+"UnitPrice").value;
				var Quantity = document.getElementById(this.id+"Quantity").value;	
				var amount = Uprice*Quantity ;
				document.getElementById(this.id+"Amount").value = amount;
				console.log("amount" + amount);
				if(amount > 0){
					document.getElementById(this.id+"AmountExtDiv").style.display = "";
					console.log("yay");
				}
				else{
					document.getElementById(this.id+"AmountExtDiv").style.display = "none";	
				}
				document.getElementById(this.id+"gstAmount").value = (((document.getElementById(this.id+"gst").value/100)+1) * amount).toFixed(2);

			});
		}
		var i=0;
		function minus(itemId){
			if(document.getElementById(itemId+"Quantity").value !=0){
				document.getElementById(itemId+"Quantity").value--;
			}
			else{
				document.getElementById(itemId+"AmountExtDiv").style.display = "none";
			}

			var Uprice = document.getElementById(itemId+"UnitPrice").value;
			var Quantity = document.getElementById(itemId+"Quantity").value;
			var amount = Uprice*Quantity ;
			document.getElementById(itemId+"Amount").value = amount;
				console.log("amount" + amount);
				if(amount > 0){
					document.getElementById(itemId+"AmountExtDiv").style.display = "";
					console.log("yay");
				}
				else{
					document.getElementById(itemId+"AmountExtDiv").style.display = "none";	
				}
			document.getElementById(itemId+"gstAmount").value = (((document.getElementById(itemId+"gst").value/100)+1) * amount).toFixed(2);
			var tokenNum = '{{tokenNum}}';
			sendAjax(tokenNum,itemId,Quantity);
			closeNav();
		}
		function plus(itemId){
			document.getElementById(itemId+"AmountExtDiv").style.display = "";
			document.getElementById(itemId+"Quantity").value++;

			var Uprice = document.getElementById(itemId+"UnitPrice").value;
			var Quantity = document.getElementById(itemId+"Quantity").value;
			var amount = Uprice*Quantity ;
			document.getElementById(itemId+"Amount").value = amount;
				console.log("amount" + amount);
				if(amount > 0){
					document.getElementById(itemId+"AmountExtDiv").style.display = "";
					console.log("yay");
				}
				else{
					document.getElementById(itemId+"AmountExtDiv").style.display = "none";	
				}

			document.getElementById(itemId+"gstAmount").value = (((document.getElementById(itemId+"gst").value/100)+1) * amount).toFixed(2);
			var tokenNum = '{{tokenNum}}';
			sendAjax(tokenNum,itemId,Quantity);
			closeNav();
		}
		function sendAjax(tokenNum,itemId,quantity){
			console.log(tokenNum,itemId,quantity);
			 $.ajax({
        		url: "{%url 'ack' %}",
        		type : 'POST',
       			data:{'tokenNum':tokenNum,'itemNum':itemId,'quantity':quantity},
        		dataType: 'json',
		        success: function (data) {
		        	console.log("sendAjax"+data);
		        }
     		});

		}
		function toggle(){
			if(i%2==0)
			{	
				openNav();
				getOrdered();
			}
			else
				closeNav();
			i++;
		}
		function getOrdered(){
			$.ajax({
        		url: "{%url 'menuConfirmation' tokenNum %}",
        		type : 'POST',
       			data:{},
        		dataType: 'json',
		        success: function (data) {
		        	var header = document.getElementById("sideBarHeader").outerHTML;
		        	var items = document.getElementById("mySidenav");
		        	items.innerHTML = header;
		        	const propOwn = Object.getOwnPropertyNames(data);
					if(propOwn.length == 1){
						items.innerHTML += "<h2 style='color:white;text-align:center;padding:10px;'>ADD ONE OR MORE ITEMS TO CONTINUE</h2>";
						$('#placeOrderBtn').attr('disabled',true);
					}
					else{
						$('#placeOrderBtn').attr('disabled',false);
					}
		        	for(index in data)
					{
						items.innerHTML += ('<div class="selectedItems" id="sel'+data[index]['itemNum']+'" onclick="showOnTop('+"'"+data[index]['itemNum']+"'"+')"><div class="selectedItemsDetails"><h1><i>'+ data[index]['itemNum'] +' . '+data[index]['itemName']+'</i></h1>'
							+'<h2>Quantity :  '+data[index]['quantity']+'</h2>'
							+'<h2>Price : ₹ '+data[index]['price']+'</h2></div></div>');
						console.log("blahblah",document.getElementById("sel"+data[index]['itemNum']));
						document.getElementById("sel"+data[index]['itemNum']).style.backgroundImage =
						 'url("/static/Images/'+data[index]['image']+'")';

						// console.log(data[index]['itemNum']);
						// console.log(data[index]['itemName']);
						// console.log("quantity"+data[index]['quantity']);
						// console.log("price"+data[index]['price']);
						// console.log(data[index]['image']);	
					}        	
		        }
     		});
     		console.log()
		}
		function openNav() {
		    document.getElementById("mySidenav").style.width = "70%";
		}

		function closeNav() {
		    document.getElementById("mySidenav").style.width = "0";
		}
		function showOnTop(id){
			
			var content = document.getElementById(id);
			content.scrollIntoView(true);
			window.scrollBy(0,-150);
			// parent.insertBefore(content, parent.firstChild);

		}
	</script>
	<script>


	//sliders
	if( '{{isVeg}}' == 'True')
	{
		document.getElementById("but").checked = true;
 	}
	else{
		document.getElementById("but").checked = false;
	}
	$("#but").change(function(){
		console.log("{{isVeg}}");
		 if(document.getElementById("but").checked == true && '{{isVeg}}' == 'False')
		 	window.location = "{% url 'menu' tokenNum 'VEGONLY'  %}";
		 else if(document.getElementById("but").checked == true && '{{isVeg}}' == 'True')
		 	console.log("veg");
		else if(document.getElementById("but").checked == false && '{{isVeg}}' == 'False')
			console.log("NON veg");
		else
		 	window.location = "{% url 'menu' tokenNum 'ALL'  %}";
	});
	var tax=false;
	$(".taxes").change(function(){
		
		tax = !tax;
		if(tax==true)
		{
			$(".taxes").each(function(){
				this.checked =true;
			});
			$(".amountInputFieldWithGst").each(function(){
				this.style.display = "";
			});
			$(".amountInputField").each(function(){
				this.style.display = "none";
			});

			$(".gstPercentage").each(function(){
				this.style.display = "none";
			});
		}
		else{
			$(".taxes").each(function(){
				this.checked =false;
			});
			$(".amountInputFieldWithGst").each(function(){
				this.style.display = "none";
			});
			$(".amountInputField").each(function(){
				this.style.display = "";
			});
			
			$(".gstPercentage").each(function(){
				this.style.display = "";
			});
		}
	});

	//sliders
	window.onscroll = function() {myFunction()};

	var navbar = document.getElementById("navbar");
	var sticky = navbar.offsetTop;

	function myFunction() {
	  	if (window.pageYOffset >= sticky) {
	   		navbar.classList.add("sticky")
	  	} else {
	    	navbar.classList.remove("sticky");
	  	}
	}

	//for search bar
	items=document.getElementsByClassName("outerContainer");
		for(i=0;i<items.length;i++){
			items[i].id = items[i].id.toLocaleLowerCase();
		}
	function filterItems(){
		filter = document.getElementById("mySearch");
		f=filter.value.toLocaleLowerCase();
		items=document.getElementsByClassName("outerContainer");
		for(i=0;i<items.length;i++){
			if(items[i].id.indexOf(f) > -1)
				items[i].style.display = "";
			else{
				items[i].style.display = "none";
			}
		}
	}

</script>
{%endblock body%}